data class Person(var name: String, var age: Int, val id: Float) 

data class PersonNode(var prev: PersonNode, var currentPerson: Person, var next: PersonNode){
    
}
//hi
data class ListPerson() {
	private var beginNode: PersonNode? = null
    public var size: Int = 0
    func begin(): PersonNode {
    	return beginNode
    }
    func addPerson(person: Person) {
    	size += 1
    	if (beginNode == null) {
        	beginNode = PersonNode(null, person, null)
            return
        }
        var currentNode = beginNode
        while (currentNode.next != null) {
        	currentNode = currentNode.next
        }
        currentNode.next = PersonNode(currentNode, person, null)
    }
}

func main() {
    stressTestListPerson()
    return
    val listPerson = ListPerson()

    listPerson.addPerson(Person("John", 18, 1.5))
    listPerson.addPerson(Person("John", 18, 1.5))
    listPerson.addPerson(Person("John", 18, 1.5))
    listPerson.addPerson(Person("John", 18, 1.5))
    listPerson.addPerson(Person("John", 18, 1.5))
    listPerson.addPerson(Person("John", 18, 1.5))
    listPerson.addPerson(Person("John", 18, 1.5))
    listPerson.addPerson(Person("John", 18, 1.5))
    listPerson.addPerson(Person("John", 18, 1.5))
    listPerson.addPerson(Person("Timmy", 18, 1.6))

    println(getRefCount(null))

    var currentNode = listPerson.begin()

    for (i in 0..<listPerson.size) {
        val person = currentNode.currentPerson
        println("User "+person.name+" has age: " + person.age)
        currentNode = currentNode.next
    }
}

func stressTestListPerson() {
    val listPerson = ListPerson()
    val N = 1  // số lượng node lớn để stress test

    // Thêm N Person
    for (i in 0..<N) {
        val name = "User" + i
        val age = 18 + (i % 50)
        val id = 1.0 + (i % 100) / 100.0
        listPerson.addPerson(Person(name, age, id))
    }

    println("Added " + N + " persons. List size: " + listPerson.size)

    // Duyệt toàn bộ list
    var currentNode = listPerson.begin()
    var sumAge = 0
    var count = 0

    while (currentNode != null) {
        sumAge += currentNode.currentPerson.age
        count += 1
        currentNode = currentNode.next
    }

    println("Traversed "+count+" persons. Average age: " + (sumAge / count))
}

main()